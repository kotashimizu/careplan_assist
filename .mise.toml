# mise configuration for AI-driven development template
# https://mise.jdx.dev/

[tools]
# Node.js - package.jsonã®enginesã«åˆã‚ã›ã¦18ç³»ã®æœ€æ–°LTSã‚’ä½¿ç”¨
node = "18.20.5"

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
# npm = "10.8.3"  # npmã¯Node.jsã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸ã¯æŒ‡å®šä¸è¦

[env]
# é–‹ç™ºç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°
NODE_ENV = "development"

# Supabaseç’°å¢ƒå¤‰æ•°ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆ.env.localã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
# å®Ÿéš›ã®å€¤ã¯.env.localã«è¨˜è¼‰
_.file = [".env.local"]

# TypeScriptè¨­å®š
TSC_COMPILE_ON_ERROR = "true"

[tasks.setup]
description = "åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— - ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ç’°å¢ƒæº–å‚™"
run = """
echo "ğŸš€ é–‹ç™ºç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ã¾ã™..."
npm install
if [ ! -f .env.local ]; then
  cp .env.example .env.local
  echo "ğŸ“ .env.local ã‚’ä½œæˆã—ã¾ã—ãŸã€‚Supabaseã®èªè¨¼æƒ…å ±ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"
fi
echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼"
"""

[tasks.dev]
description = "é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•"
run = "npm run dev"

[tasks.build]
description = "ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰"
run = "npm run build"

[tasks.check]
description = "ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ã€ãƒªãƒ³ãƒˆã€ä¾å­˜é–¢ä¿‚ï¼‰"
run = """
echo "ğŸ” ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™..."
npm run typecheck
npm run lint
npm run check:dependencies
echo "âœ… ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
"""

[tasks.clean]
description = "ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªãƒ¼ãƒ³"
run = """
echo "ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ä¸­..."
rm -rf .next
rm -rf node_modules
rm -rf .turbo
echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†ï¼"
"""

[tasks.reinstall]
description = "ä¾å­˜é–¢ä¿‚ã‚’å®Œå…¨ã«å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
depends = ["clean"]
run = """
echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™..."
npm install
echo "âœ… å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†ï¼"
"""

[tasks.docker-up]
description = "Dockerç’°å¢ƒã‚’èµ·å‹•ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰"
run = """
if [ -f docker-compose.yml ]; then
  docker-compose up -d
  echo "ğŸ³ Dockerç’°å¢ƒãŒèµ·å‹•ã—ã¾ã—ãŸ"
else
  echo "â„¹ï¸  docker-compose.yml ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
fi
"""

[tasks.docker-down]
description = "Dockerç’°å¢ƒã‚’åœæ­¢ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰"
run = """
if [ -f docker-compose.yml ]; then
  docker-compose down
  echo "ğŸ³ Dockerç’°å¢ƒã‚’åœæ­¢ã—ã¾ã—ãŸ"
else
  echo "â„¹ï¸  docker-compose.yml ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
fi
"""

# é–‹ç™ºãƒ•ãƒ­ãƒ¼ç”¨ã®è¤‡åˆã‚¿ã‚¹ã‚¯
[tasks.start]
description = "å®Œå…¨ãªé–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ï¼ˆDocker + é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼‰"
run = """
mise run docker-up
mise run dev
"""

[tasks.stop]
description = "é–‹ç™ºç’°å¢ƒã‚’åœæ­¢"
run = """
mise run docker-down
echo "ğŸ‘‹ é–‹ç™ºç’°å¢ƒã‚’åœæ­¢ã—ã¾ã—ãŸ"
"""