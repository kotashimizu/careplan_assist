# ケアチェックアシスト プロジェクト指針書

## プロジェクト概要

ケアチェックアシストは、介護事業所向けの業務管理システムです。複数の事業所（会社単位）での利用を想定しており、各事業所が独立してデータを管理できるマルチテナント構造を採用しています。

## システム構成

- **フロントエンド**: React + TypeScript + Vite
- **スタイリング**: TailwindCSS
- **認証/データベース**: Supabase
- **デプロイ**: Vercel

## 環境設定

### 環境変数

環境変数は `.env.local` ファイルで管理しています。以下の設定が必要です：

```
# 環境設定（local, demo, production）
VITE_ENVIRONMENT=demo

# Supabase設定
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJxxxxx
```

各環境の特徴：
- **local**: モックデータを使用。データベース接続なしでも動作
- **demo**: 実際のSupabaseに接続するがテストデータを使用
- **production**: 本番用Supabaseに接続

### デプロイ設定

Vercelにデプロイする際は、以下の環境変数を設定する必要があります：
- `VITE_ENVIRONMENT=production`
- `VITE_SUPABASE_URL`（本番用）
- `VITE_SUPABASE_ANON_KEY`（本番用）

## マルチテナント対応

このシステムは複数事業所に対応するマルチテナント構造です：

1. **データベース設計**
   - 全テーブルが `organization_id` と紐づいています
   - 各クエリは事業所IDでフィルタリングされます

2. **認証フロー**
   - ユーザー登録時に事業所を選択または新規作成
   - ログイン後は自分の事業所のデータのみ表示

3. **アクセス制御**
   - Row Level Security (RLS) により、ユーザーは自分の事業所のデータのみアクセス可能
   - 事業所管理者は事業所内の全データにアクセス可能

## 開発ガイドライン

1. **データ取得**
   - 全てのデータ取得関数は事業所IDによるフィルタリングを含める
   - 新規データ作成時は自動的に現在の事業所IDをセット

2. **認証処理**
   - AuthContextは認証状態と共に現在の事業所情報も管理
   - 未認証ユーザーはログインページにリダイレクト

3. **エラーハンドリング**
   - すべてのAPI呼び出しは適切なエラーハンドリングを実装
   - ユーザーに分かりやすいエラーメッセージを表示

## リリース手順

1. **テスト**
   - ローカル環境でのテスト
   - デモ環境でのテスト

2. **本番デプロイ**
   - Vercelへの設定（環境変数を含む）
   - デプロイ後の動作確認

3. **モニタリング**
   - エラーログの監視
   - パフォーマンスの監視
